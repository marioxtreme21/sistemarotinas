<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:pesquisaTemplateComposite="http://xmlns.jcp.org/jsf/composite/componentes"
	xmlns:botoesCrudComposite="http://xmlns.jcp.org/jsf/composite/componentes"
	template="/WEB-INF/templates/layout.xhtml">

	<ui:define name="title">Cadastro de Usuários</ui:define>

	<ui:define name="content">

		
		<h:form id="formPesquisaUsuario">
			<ui:include src="/resources/componentes/pesquisaUsuario.xhtml" />
		</h:form>

	
		<h:form id="formCadastroUsuario">
			<p:growl id="growl" showDetail="true" life="3000" />

			<p:toolbar>
				<p:toolbarGroup>
					<p:commandButton value="Novo Usuário"
						actionListener="#{userEditBean.prepareCreateUser}"
						update="formCadastroUsuario" process="@this" resetValues="true"
						oncomplete="PF('userDialog').show()" icon="pi pi-plus"
						styleClass="ui-button-success" />
				</p:toolbarGroup>
				<p:toolbarGroup align="right">
					<p:commandButton value="Testar Conexão com AD"
						actionListener="#{userEditBean.testarConexaoAD}" update="growl"
						process="@this" icon="pi pi-link" styleClass="ui-button-info" />

					<p:commandButton value="Importar Usuários do Domínio"
						actionListener="#{userEditBean.importarUsuariosAD}"
						update="tableUsuarios, growl" process="@this"
						icon="pi pi-download" styleClass="ui-button-success" />
				</p:toolbarGroup>
			</p:toolbar>

			<p:dialog id="userDialog"
				header="#{userEditBean.editing ? 'Edição de Usuário' : 'Criar Novo Usuário'}"
				widgetVar="userDialog" modal="true" resizable="false"
				styleClass="wide-dialog">

				<h:panelGroup layout="block"
					style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
					<h:panelGrid columns="2" cellpadding="10" style="width: 100%;">

						<h:outputLabel for="nome" value="Nome:" />
						<p:inputText id="nome" value="#{userEditBean.user.nome}" required="true" />

						<h:outputLabel for="sobrenome" value="Sobrenome:" />
						<p:inputText id="sobrenome" value="#{userEditBean.user.sobrenome}" />

						<h:outputLabel for="username" value="Username:" />
						<p:inputText id="username" value="#{userEditBean.user.username}" required="true" />

						<h:outputLabel for="password" value="Senha:" />
						<p:password id="password" value="#{userEditBean.user.password}"
							required="#{not userEditBean.editing}" />
							
						<h:outputLabel for="role" value="Papel:" />
						<p:selectOneMenu id="role" value="#{userEditBean.selectedRole}"
							converter="roleConverter" required="true">
							<f:selectItem itemLabel="Selecione" itemValue="#{null}" />
							<f:selectItems value="#{userEditBean.availableRoles}" var="role"
								itemLabel="#{role.name}" itemValue="#{role}" />
						</p:selectOneMenu>

						<h:outputLabel for="lojasPickList" value="Lojas Permitidas:" />
						<p:pickList id="lojasPickList"
							value="#{userEditBean.lojasDualList}" var="loja"
							itemLabel="#{loja.nome}" itemValue="#{loja}"
							converter="lojaConverter" showSourceControls="true"
							showTargetControls="true" showSourceFilter="true"
							showTargetFilter="true" filterMatchMode="contains"
							responsive="true" styleClass="wide-picklist">
							<f:facet name="sourceCaption">Disponíveis</f:facet>
							<f:facet name="targetCaption">Selecionadas</f:facet>
							<p:column
								style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 320px;">
								<h:outputText value="#{loja.nome}" title="#{loja.nome}" />
							</p:column>
						</p:pickList>
					</h:panelGrid>
				</h:panelGroup>

				<p:separator />
				<p:commandButton value="#{userEditBean.editing ? 'Atualizar' : 'Salvar'}"
					action="#{userEditBean.saveUser}" update="formTable formCadastroUsuario growl"
					process="@form" oncomplete="PF('userDialog').hide()"
					icon="pi pi-save"
					style="width: 100%; max-width: 200px; display: block; margin: 10px auto;" />

			</p:dialog>
		</h:form>


		<h:form id="formTable">
			<p:dataTable id="tableUsuarios" value="#{userEditBean.usuariosLazy}"
				var="user" paginator="true" rows="10" lazy="true" responsive="true"
				rowsPerPageTemplate="10,20,50"
				emptyMessage="Nenhum usuário encontrado.">
				<ui:include src="/resources/componentes/dataTableCadastroUsuario.xhtml" />
			</p:dataTable>
		</h:form>

	</ui:define>
</ui:composition>
